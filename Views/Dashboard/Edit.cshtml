@using System.ComponentModel.DataAnnotations;
@using System.Reflection;
@using fullstack_portfolio.Data;
@using fullstack_portfolio.Utils;
@model IMongoModel

@{
  var id = @Model.GetType().GetProperty("_id")?.GetValue(Model);
  var collection = Context.Request.Path.Value?.Split("/")[2];
}


<section>
  <form id="edit" action="/dashboard/@collection/@id/save" method="post" enctype="multipart/form-data" class="grid">
    @foreach (var field in Model.GetType().GetProperties())
    {
      if (field.Name == "_id")
      {
        <input asp-for="@field" name="@field.Name" value="@id" hidden aria-hidden="true" />
        continue;
      }
      <div class="flex flex-col">

      @if (field.PropertyType.IsEnum)
      {
        <label for="@field.Name">@field.Name</label>
        @Html.DropDownList(field.Name, new SelectList(Enum.GetValues(field.PropertyType)),
               "Select " + field.Name, new { @class = "bg-primary border-2 border-primary-700" })
      }

      else if (EditUtils.IsTextArea(field))
      {
        <label for="@field.Name">@field.Name</label>
        @Html.TextArea(field.Name, field.GetValue(Model)?.ToString(), new { @class = "bg-transparent border-2 border-primary-700", @rows = 5})
      }

      else if (EditUtils.IsFile(field))
      {
        <div class="flex gap-2 items-center">
          <label for="file">@field.Name</label>
          <p class="opacity-75 text-sm">
            Current: <a href="@EditUtils.TrimPath(field, Model)">@EditUtils.TrimPath(field, Model)</a>
          </p>
        </div>
        <input type="file" id="file" name="file" value="@field.GetValue(Model)"></input>
        <!-- the actual image url -->
        <!-- it is added so that the url will not get removed if an empty file is passed -->
        <input name="@field.Name" value="@field.GetValue(Model)" class="bg-transparent border-2 border-primary-700" hidden />
      }

      else if (field.PropertyType.ToString() == "System.Boolean")
      {
        <div>
          <label for="@field.Name">@field.Name</label>
          <input type="checkbox" name="@field.Name" value="@field.GetValue(Model)" id="@field.Name"
            class="bg-transparent border-2 border-primary-700" />
        </div>
      }

      else
      {
        <label for="@field.Name">@field.Name</label>
        <input asp-for="@field" name="@field.Name" value="@field.GetValue(Model)" id="@field.Name"
          class="bg-transparent border-2 border-primary-700" />
      }
      <span data-valmsg-for="@field.Name" data-valmsg-replace="true" class="text-red-500 field-validation-valid"></span>
    </div>
    }
    <button type="submit">Save</button>
    <button type="button">Remove (todo)</button>
    <span id="general-error" class="text-red-500"></span>
  </form>
</section>

@section Scripts {
  <script src="~/js/savechanges.js" defer></script>
  <script src="~/js/stringlist.js" defer></script>
}
